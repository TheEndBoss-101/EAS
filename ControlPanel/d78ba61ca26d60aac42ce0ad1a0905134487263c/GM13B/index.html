<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARC EAS</title>
    <!--script src="./eas_main.js?version=5.0" defer></script-->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <style>
        pre {
            display: inline-block;
        }
    </style>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script type="module">
        import { Octokit } from "https://cdn.skypack.dev/@octokit/core";
        //alert("WARNING: HIGHLY EXPERMENTAL!")
        console.log("EAS_MAIN.JS - V: 5.0")
        const octokit = new Octokit({ auth: `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` });
        async function sendeas() {
            var getfromgit = await octokit.request('GET /repos/TheEndBoss-101/EAS/contents/EAS/Send.html', {
                owner: 'TheEndBoss-101',
                repo: 'EAS',
                path: 'EAS/Send.html',
            })
            console.log(getfromgit)
            //var getfromgitJson = JSON.parse(getfromgit);
            //console.log(getfromgitJson)
            var gitsha = getfromgit.data["sha"]
            console.log(gitsha);
            //var gitcontent = btoa('Hello, World! TESTING');
            console.log(gitcontent)
            await octokit.request('PUT /repos/TheEndBoss-101/EAS/contents/EAS/Send.html', {
                owner: 'TheEndBoss-101',
                repo: 'EAS',
                path: 'EAS/Send.html',
                message: 'SEND EAS MESSAGE',
                committer: {
                    name: 'TheEndBoss-101',
                    email: 'theendboss101@gmail.com'
                },
                content: `${gitcontent}`,
                sha: `${gitsha}`
            })
        }

        const $ = document.querySelector.bind(document);
        const $$ = document.querySelectorAll.bind(document);

        const loadStates = async () => {
            return await (await fetch("./state.json")).json();
        };

        const loadCounties = async () => {
            return await (await fetch("./county.json")).json();
        };

        let states, counties;

        (async () => {
            try {
                states = await loadStates();
                counties = await loadCounties();

                $("#state").innerHTML = "<option value=\"00\">Entire nation</option>";
                Object.keys(states).forEach((id) => {
                    const o = document.createElement('option');
                    o.value = id;
                    o.innerText = states[id];
                    $("#state").appendChild(o);
                });

                updateCounties();
            } catch (e) {
                alert(`Failed to load states and counties. ${e}`)
            }

            // generate();
        })();

        function updateCounties() {
            $("#county").innerHTML = "<option value=\"000\">Entire state</option>";
            Object.keys(counties[$("#state").value] || []).forEach((id) => {
                const o = document.createElement('option');
                o.value = id;
                o.innerText = counties[$("#state").value][id];
                $("#county").appendChild(o);
            });
        }

        function sendMessage() {
            const ORG = originator.value
            //console.log(ORG)
            const EEE = events.value
            //console.log(EEE)
            const P = subdiv.value
            //console.log(P)
            const SS = state.value
            //console.log(SS)
            const CCC = county.value
            //console.log(CCC)
            const PSSCCC = P + SS + CCC
            //console.log(PSSCCC)
            const HHMM = purgetime.value
            //console.log(HHMM)
            const LLLLLLLL = senderCallsign.value
            //console.log(LLLLLLLL)
            const MSG = message.value
            //console.log(MSG)
            const EAS_WEBHOOK = webhook.value
            //console.log(EAS_WEBHOOK)

            const request = new XMLHttpRequest();
            request.open("POST", `${EAS_WEBHOOK}`);
            request.setRequestHeader('Content-type', 'application/json');
            const params = {
                content: `EAS EVENT: \`${ORG}-${EEE}-${PSSCCC}-${HHMM}-${LLLLLLLL}\` \n\n Transcript: \`${MSG}\` \n `,
                ttss: true
            }

            request.send(JSON.stringify(params));
            sendeas()
            var gitcontent = btoa(`${ORG}-${EEE}-${PSSCCC}-${HHMM}-${LLLLLLLL}`);
        }

        function sendRWT() {
            const ORG = originator.value
            const P = subdiv.value
            const SS = state.value
            const CCC = county.value
            const PSSCCC = P + SS + CCC
            const LLLLLLLL = senderCallsign.value
            const EAS_WEBHOOK = webhook.value

            const request = new XMLHttpRequest();
            request.open("POST", `${EAS_WEBHOOK}`);
            request.setRequestHeader('Content-type', 'application/json');
            const params = {
                content: `EAS EVENT: \`${ORG}-RWT-${PSSCCC}-1200-${LLLLLLLL}\` \n\n Transcript: \`This is a coordinated weekly test of the broadcast stations of your area. We are testing equipment that can quickly warn you during emergencies. If this had been an actual emergency, an official message would have followed the alert tone. This concludes this test of the Emergency Alert System.\` \n `,
                ttss: true
            }

            request.send(JSON.stringify(params));
        }

        function sendRMT() {
            const ORG = originator.value
            const P = subdiv.value
            const SS = state.value
            const CCC = county.value
            const PSSCCC = P + SS + CCC
            const LLLLLLLL = senderCallsign.value
            const EAS_WEBHOOK = webhook.value

            const request = new XMLHttpRequest();
            request.open("POST", `${EAS_WEBHOOK}`);
            request.setRequestHeader('Content-type', 'application/json');
            const params = {
                content: `EAS EVENT: \`${ORG}-RMT-${PSSCCC}-1200-${LLLLLLLL}\` \n\n Transcript: \`This is a coordinated monthly test of the broadcast stations of your area. We are testing equipment that can quickly warn you during emergencies. If this had been an actual emergency, an official message would have followed the alert tone. This concludes this test of the Emergency Alert System.\` \n `,
                ttss: true
            }

            request.send(JSON.stringify(params));
        }

        function sendRDT() {
            const ORG = originator.value
            const P = subdiv.value
            const SS = state.value
            const CCC = county.value
            const PSSCCC = P + SS + CCC
            const LLLLLLLL = senderCallsign.value
            const EAS_WEBHOOK = webhook.value

            const request = new XMLHttpRequest();
            request.open("POST", `${EAS_WEBHOOK}`);
            request.setRequestHeader('Content-type', 'application/json');
            const params = {
                content: `EAS EVENT: \`${ORG}-RDT-${PSSCCC}-1200-${LLLLLLLL}\` \n\n Transcript: \`This is a coordinated daily test of the broadcast stations of your area. We are testing equipment that can quickly warn you during emergencies. If this had been an actual emergency, an official message would have followed the alert tone. This concludes this test of the Emergency Alert System.\` \n `,
                ttss: true
            }

            request.send(JSON.stringify(params));
        }

        function generate() {
            const ORG = originator.value
            const EEE = events.value
            const P = subdiv.value
            const SS = state.value
            const CCC = county.value
            const PSSCCC = P + SS + CCC
            const HHMM = purgetime.value
            const LLLLLLLL = senderCallsign.value
            const MSG = message.value
            const EAS_WEBHOOK = webhook.value

            $("#code").innerText = `WebHook: ${EAS_WEBHOOK} \n Code: ${ORG}-${EEE}-${PSSCCC}-${HHMM}-${LLLLLLLL} \n Message: ${MSG}`;
        }

//generate()
    </script>
</head>

<body>
    <h1>EAS (Emergency Alert System) ARC Webhook.</h1>
    <h2>V5.0</h2>
    <a href="https://github.com/TheEndBoss-101/EAS" target="_BLANK">Github Repo</a>
    <br>
    <a
        href="https://theendboss-101.github.io/EAS/ControlPanel/d78ba61ca26d60aac42ce0ad1a0905134487263c/index.html">Back</a>
    <br>
    <br>
    <fieldset>
        <fieldset>
            <legend>Webhook</legend>
            <textarea id="webhook" placeholder="Webhook" rows="2" cols="68"
                onchange="generate()">https://discord.com/api/webhooks/965359101926314025/H6RpMxAvESc9GQ3ip-wPVCqxSgeBwknVHaWZSE3v6PiaRmsw7GGBlqkINK7ff12V9M3g</textarea>
        </fieldset>
        <legend>Make</legend>
        <fieldset>
            <legend>Originator</legend>
            <select id="originator" onchange="generate()">
                <option value="PEP">PEP - Primary Entry Point System</option>
                <option value="CIV">CIV - Civil authorities</option>
                <option value="EAS" selected>EAS - Emergency Alert System participant</option>
                <option value="ARC">ARC - Annomly Research Center</option>
                <option value="AMTF">AMTF - Anti Mingebag Task Force</option>
                <option value="AMRC">AMRC - Anti Mingebag Research Center</option>
            </select>
        </fieldset>
        <fieldset>
            <legend>Event - Wip</legend>
            <select id="events" onchange="generate()">
                <option value="DMO" selected>DMO - Practice/Demo Warning</option>
                <option value="RWT">RWT - Required Weekly Test</option>
                <option value="RMT">RMT - Required Monthly Test</option>
                <option value="RDT">RDT - Required Daily Test</option>
            </select>
        </fieldset>
        <fieldset>
            <legend>Location</legend>
            <fieldset>
                <legend>Area</legend>
                <select id="subdiv" onchange="generate()">
                    <option value="0" selected>Entire region</option>
                    <option value="1">Northwest</option>
                    <option value="2">North</option>
                    <option value="3">Northeast</option>
                    <option value="4">West</option>
                    <option value="5">Center</option>
                    <option value="6">East</option>
                    <option value="7">Southwest</option>
                    <option value="8">South</option>
                    <option value="9">Southeast</option>
                </select>
            </fieldset>
            <fieldset>
                <legend>State</legend>
                <select id="state" onchange="updateCounties();generate()">
                    <option value="00">Loading...</option>
                </select>
            </fieldset>
            <fieldset>
                <legend>County</legend>
                <select id="county" onchange="generate()">
                    <option value="000">Loading...</option>
                </select>
            </fieldset>
        </fieldset>
        <fieldset>
            <legend>Purge time (HHMM)</legend>
            <select id="purgetime" onchange="generate()">
                <option value="0000">0000</option>
                <option value="0015" selected>0015</option>
                <option value="0030">0030</option>
                <option value="0045">0045</option>
                <option value="0100">0100</option>
                <option value="0130">0130</option>
                <option value="0200">0200</option>
                <option value="0230">0230</option>
                <option value="0300">0300</option>
                <option value="0330">0330</option>
                <option value="0400">0400</option>
                <option value="0430">0430</option>
                <option value="0500">0500</option>
                <option value="0530">0530</option>
                <option value="0600">0600</option>
                <option value="0700">0700</option>
                <option value="0800">0800</option>
                <option value="0900">0900</option>
                <option value="1000">1000</option>
                <option value="1100">1100</option>
                <option value="1200">1200</option>
                <option value="1300">1300</option>
                <option value="1400">1400</option>
                <option value="1500">1500</option>
                <option value="1600">1600</option>
                <option value="1700">1700</option>
                <option value="1800">1800</option>
                <option value="1900">1900</option>
                <option value="2000">2000</option>
                <option value="2100">2100</option>
                <option value="2200">2200</option>
                <option value="2300">2300</option>
                <option value="2400">2400</option>
                <option value="4800">4800</option>
                <option value="9600">9600</option>
            </select>
        </fieldset>
        <fieldset>
            <legend>Sender Call Sign</legend>
            <input type="text" id="senderCallsign" maxlength="8" onchange="generate()" placeholder="WHITEHSE" />
        </fieldset>
        <fieldset>
            <legend>Message</legend>
            <textarea id="message" placeholder="Message" rows="4" cols="50" onchange="generate()"></textarea>
        </fieldset>
    </fieldset>
    </fieldset>
    <fieldset>
        <legend>Review</legend>
        <fieldset>
            <legend>Code</legend>
            <div>
                <textarea id="code" placeholder="{WAITING FOR USER INPUIT}" rows="4" cols="58" readonly></textarea>
            </div>
        </fieldset>
    </fieldset>
    <fieldset>
        <legend>Send</legend>
        <fieldset>
            <legend>Send</legend>
            <button onclick="sendMessage()">Send</button>
            <br>
            <br>
            <button onclick="sendRMT()">Send Required Monthly Test</button>
            <p>MESSAGE FOR RMT:</p>
            <p>This is a coordinated monthly test of the broadcast stations of your area. We are testing equipment that
                can quickly warn you during emergencies. If this had been an actual emergency, an official message would
                have followed the alert tone. This concludes this test of the Emergency Alert System.</p>
            <br>
            <button onclick="sendRWT()">Send Required Weekly Test</button>
            <p>MESSAGE FOR RWT:</p>
            <p>This is a coordinated weekly test of the broadcast stations of your area. We are testing equipment that
                can quickly warn you during emergencies. If this had been an actual emergency, an official message would
                have followed the alert tone. This concludes this test of the Emergency Alert System.</p>
            <br>
            <button onclick="sendRDT()">Send Required Daily Test</button>
            <p>MESSAGE FOR RDT:</p>
            <p>This is a coordinated daily test of the broadcast stations of your area. We are testing equipment that
                can quickly warn you during emergencies. If this had been an actual emergency, an official message would
                have followed the alert tone. This concludes this test of the Emergency Alert System.</p>
        </fieldset>
    </fieldset>
</body>

</html>